# 银行重要数据跨境数据管控系统 - 项目指南

## 项目概述

**项目名称：** 银行重要数据跨境数据管控系统 (Cross-border Data Transfer Control System)  
**项目ID：** datareg  
**作者：** 张彦龙  
**目标：** 构建银行跨境数据传输的合规管控平台，实现"事前审批-事中监控-事后审计"全流程闭环

## 技术架构

### 技术栈
- **后端框架：** FastAPI (Python 3.11+)
- **前端框架：** React 18 + TypeScript + Ant Design
- **数据库：** PostgreSQL 14+
- **认证授权：** JWT Token
- **API文档：** Swagger/OpenAPI
- **任务队列：** Celery (可选，用于异步处理)
- **缓存：** Redis (可选)

### 系统架构
```
┌─────────────────┐
│  前端管理界面    │  React + Ant Design
└────────┬────────┘
         │ HTTP/REST
┌────────▼─────────────────────────┐
│      FastAPI 后端服务             │
│  ┌─────────────────────────────┐ │
│  │ 数据资产分类分级模块          │ │
│  │ 跨境场景管理模块              │ │
│  │ 风险评估引擎                  │ │
│  │ 拦截与脱敏模块                │ │
│  │ 监控审计模块                  │ │
│  └─────────────────────────────┘ │
└────────┬─────────────────────────┘
         │
┌────────▼────────┐
│  PostgreSQL     │
│  数据存储        │
└─────────────────┘
```

## 核心模块

### 1. 数据资产分类分级模块
- 元数据扫描与自动打标
- 敏感数据识别（PII、重要数据）
- 数据血缘追踪
- 标签热更新机制

### 2. 跨境传输场景管理
- 业务场景备案
- 传输要素管理（接收方、目的国、存储期限等）
- 场景审批流程

### 3. 数据出境风险自评估引擎
- 自评估模板（PIA/DPIA）
- 阈值预警（100万个人信息/10万敏感个人信息）
- 合规性评分

### 4. 事中拦截与动态脱敏
- API网关拦截
- 黑白名单策略
- 实时脱敏（假名化、遮掩）
- 核心数据拦截

### 5. 监控与审计仪表盘
- 跨境流量监控
- 异常行为检测
- 审计日志
- 合规报表

## 数据库设计

### 核心表结构
- `data_assets` - 数据资产表
- `data_classification` - 数据分类分级表
- `cross_border_scenarios` - 跨境传输场景表
- `risk_assessments` - 风险评估表
- `transfer_approvals` - 传输审批表
- `audit_logs` - 审计日志表
- `sensitive_tags` - 敏感标签定义表
- `users` - 用户表
- `roles` - 角色权限表

## 合规依据

- 《中华人民共和国数据安全法》
- 《中华人民共和国个人信息保护法》
- 网信办《数据出境安全评估办法》
- 《促进和规范数据跨境流动规定》
- 《金融行业数据安全分级指南》(JR/T 0197)
- 《银行核算数据跨境传输安全规范》

## 用户定义命名空间

- frontend - 前端相关组件
- backend - 后端API和服务
- database - 数据库模型和迁移
- compliance - 合规规则引擎
- monitoring - 监控和审计模块

## 实现细节

### 数据资产分类分级
- **扫描器** (`app/utils/data_scanner.py`): 自动扫描PostgreSQL数据库元数据，发现表和字段
- **分类引擎** (`app/utils/classification_engine.py`): 基于规则自动识别敏感数据和重要数据
- **识别规则**: 
  - 核心数据: 包含"核心"、"core"、"国家安全"关键词
  - 重要数据: 匹配信贷总量、风险暴露、跨境支付等模式
  - 敏感个人信息: 识别身份证、手机号、银行卡等字段
  - 一般个人信息: 识别客户、个人信息等字段

### 风险评估引擎
- **评估维度**: 法律环境、数据规模、安全措施、数据敏感性
- **阈值检查**: 
  - 个人信息: 100万条
  - 敏感个人信息: 10万条
  - 接近阈值预警: 95%阈值时预警
- **风险等级**: 低风险(≥80分)、中风险(60-80分)、高风险(40-60分)、极高风险(<40分)

### 拦截与脱敏
- **白名单机制**: 已批准的传输申请自动加入白名单
- **黑名单机制**: 禁止特定数据资产出境
- **脱敏策略**:
  - 身份证: 保留前3位和后4位
  - 手机号: 保留前3位和后4位
  - 银行卡: 保留后4位
  - 姓名: 假名化（SHA256哈希）
  - 邮箱: 遮掩@前部分

### 监控仪表盘
- **概览统计**: 场景数、审批数、传输成功率、异常数
- **传输趋势**: 按日期统计传输次数和传输量
- **目的国分布**: 统计各目的国的传输情况
- **风险预警**: 阈值预警、高风险评估、接近阈值预警

## 文件结构

### 后端核心文件
- `app/main.py` - FastAPI应用入口
- `app/core/config.py` - 配置管理
- `app/core/database.py` - 数据库连接
- `app/models/` - SQLAlchemy数据模型
- `app/schemas/` - Pydantic验证模型
- `app/services/` - 业务逻辑层
- `app/utils/` - 工具函数（扫描器、分类引擎、脱敏引擎）
- `app/api/v1/endpoints/` - API端点

### 前端核心文件
- `src/App.tsx` - 应用主组件
- `src/components/Layout.tsx` - 布局组件
- `src/pages/` - 页面组件
- `src/services/api.ts` - API服务封装

## 启动流程

1. **初始化数据库**: `python backend/init_db.py`
2. **启动后端**: `cd backend && uvicorn app.main:app --reload`
3. **启动前端**: `cd frontend && npm install && npm run dev`
4. **访问系统**: `http://localhost:3000`

## 开发规范

- 所有文件作者: 张彦龙
- 代码风格: Python遵循PEP8，TypeScript遵循ESLint
- 数据库迁移: 使用Alembic
- API文档: 自动生成Swagger文档

