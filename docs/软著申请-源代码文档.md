# 银行重要数据跨境管控系统
## 源代码文档

**软件名称**: 银行重要数据跨境管控系统
**版本号**: v1.2.0
**开发语言**: Python 3.11 + TypeScript/JavaScript
**总行数**: 约15,000行
**开发者**: 张彦龙

---

## 第一部分：系统核心框架代码

### 1. 主程序入口 (app/main.py)

```python
"""
系统主程序入口
作者：张彦龙
"""
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.core.database import engine, Base
from app.api.v1.api import api_router
from contextlib import asynccontextmanager


@asynccontextmanager
async def lifespan(app: FastAPI):
    """应用生命周期管理"""
    # 启动时执行
    print(f"{settings.PROJECT_NAME} 启动成功")
    print(f"API文档: http://localhost:8000{settings.API_V1_STR}/docs")
    yield
    # 关闭时执行
    print("应用关闭")


# 创建FastAPI应用实例
app = FastAPI(
    title=settings.PROJECT_NAME,
    version=settings.VERSION,
    lifespan=lifespan
)

# 配置CORS中间件
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# 注册API路由
app.include_router(api_router, prefix=settings.API_V1_STR)


@app.get("/")
async def root():
    """根路径"""
    return {
        "message": settings.PROJECT_NAME,
        "version": settings.VERSION,
        "author": "张彦龙"
    }


@app.get("/health")
async def health():
    """健康检查接口"""
    return {"status": "healthy"}
```

### 2. 系统配置 (app/core/config.py)

```python
"""
系统配置管理
作者：张彦龙
"""
from pydantic_settings import BaseSettings
from typing import List


class Settings(BaseSettings):
    """应用配置类"""
    
    # 项目基本信息
    PROJECT_NAME: str = "银行重要数据跨境数据管控系统"
    VERSION: str = "1.2.0"
    API_V1_STR: str = "/api/v1"
    
    # 数据库配置
    POSTGRES_SERVER: str = "localhost"
    POSTGRES_USER: str = "postgres"
    POSTGRES_PASSWORD: str = "3f342bb206"
    POSTGRES_DB: str = "datareg"
    DATABASE_URL: str = f"postgresql://{POSTGRES_USER}:{POSTGRES_PASSWORD}@{POSTGRES_SERVER}:5432/{POSTGRES_DB}"
    
    # JWT安全配置
    SECRET_KEY: str = "your-secret-key-change-in-production"
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 60 * 24  # 24小时
    
    # CORS跨域配置
    CORS_ORIGINS: List[str] = [
        "http://localhost:3000",
        "http://localhost:5173",
        "http://127.0.0.1:3000",
    ]
    
    # 合规阈值配置
    PERSONAL_INFO_THRESHOLD: int = 1000000  # 100万个人信息
    SENSITIVE_INFO_THRESHOLD: int = 100000   # 10万敏感个人信息
    
    # Redis缓存配置（可选）
    REDIS_HOST: str = "localhost"
    REDIS_PORT: int = 6379
    REDIS_DB: int = 0
    
    class Config:
        env_file = ".env"
        case_sensitive = True


# 全局配置实例
settings = Settings()
```

### 3. 数据库配置 (app/core/database.py)

```python
"""
数据库连接管理
作者：张彦龙
"""
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from app.core.config import settings

# 创建数据库引擎
engine = create_engine(
    settings.DATABASE_URL,
    pool_pre_ping=True,
    pool_size=10,
    max_overflow=20,
)

# 创建会话工厂
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# 创建Base类
Base = declarative_base()


def get_db():
    """获取数据库会话"""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

### 4. JWT安全认证 (app/core/security.py)

```python
"""
JWT安全认证模块
作者：张彦龙
"""
from datetime import datetime, timedelta
from typing import Optional
from jose import JWTError, jwt
from passlib.context import CryptContext
from app.core.config import settings

# 密码加密上下文
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")


def verify_password(plain_password: str, hashed_password: str) -> bool:
    """验证密码"""
    return pwd_context.verify(plain_password, hashed_password)


def get_password_hash(password: str) -> str:
    """生成密码哈希"""
    return pwd_context.hash(password)


def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):
    """创建访问令牌"""
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=15)
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt


def verify_token(token: str) -> Optional[str]:
    """验证令牌"""
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        username: str = payload.get("sub")
        if username is None:
            return None
        return username
    except JWTError:
        return None
```

### 5. 权限管理 (app/core/permissions.py)

```python
"""
权限管理模块
作者：张彦龙
"""
from enum import Enum
from typing import List, Optional
from fastapi import HTTPException, status
from sqlalchemy.orm import Session
from app.models.user import User, Role, Permission


class PermissionEnum(str, Enum):
    """权限枚举"""
    VIEW_ASSETS = "view_assets"  # 查看资产
    CREATE_ASSETS = "create_assets"  # 创建资产
    EDIT_ASSETS = "edit_assets"  # 编辑资产
    DELETE_ASSETS = "delete_assets"  # 删除资产
    
    VIEW_SCENARIOS = "view_scenarios"  # 查看场景
    CREATE_SCENARIOS = "create_scenarios"  # 创建场景
    EDIT_SCENARIOS = "edit_scenarios"  # 编辑场景
    DELETE_SCENARIOS = "delete_scenarios"  # 删除场景
    APPROVE_SCENARIOS = "approve_scenarios"  # 审批场景
    
    VIEW_RISKS = "view_risks"  # 查看风险评估
    CREATE_RISKS = "create_risks"  # 创建风险评估
    EDIT_RISKS = "edit_risks"  # 编辑风险评估
    CALCULATE_RISKS = "calculate_risks"  # 执行评估计算
    
    VIEW_APPROVALS = "view_approvals"  # 查看审批
    CREATE_APPROVALS = "create_approvals"  # 创建审批
    APPROVE_TRANSFERS = "approve_transfers"  # 批准传输
    REJECT_TRANSFERS = "reject_transfers"  # 拒绝传输
    
    VIEW_AUDIT = "view_audit"  # 查看审计日志
    EXPORT_DATA = "export_data"  # 导出数据
    MANAGE_USERS = "manage_users"  # 管理用户
    MANAGE_ROLES = "manage_roles"  # 管理角色


def check_permission(db: Session, user: User, permission: str) -> bool:
    """检查用户是否有指定权限"""
    if user.is_superuser:
        return True
    
    for role in user.roles:
        for perm in role.permissions:
            if perm.code == permission or perm.code == "admin":
                return True
    
    return False


def require_permission(db: Session, user: User, permission: str):
    """要求用户必须有指定权限，否则抛出异常"""
    if not check_permission(db, user, permission):
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail=f"权限不足: {permission}"
        )


class PermissionChecker:
    """权限检查器"""
    def __init__(self, required_permissions: List[str]):
        self.required_permissions = required_permissions
```

### 6. 数据资产模型 (app/models/data_asset.py)

```python
"""
数据资产模型
作者：张彦龙
"""
from sqlalchemy import Column, Integer, String, DateTime, Text, ForeignKey, Boolean, Float
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from app.core.database import Base


class Classification(Base):
    """数据分类模型"""
    __tablename__ = "classifications"
    
    id = Column(Integer, primary_key=True, index=True)
    code = Column(String(50), unique=True, index=True, nullable=False)
    name = Column(String(200), nullable=False)
    description = Column(Text)
    parent_id = Column(Integer, ForeignKey("classifications.id"), nullable=True)
    level = Column(Integer, default=1)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
    
    children = relationship("Classification", back_populates="parent", remote_side=[id])
    parent = relationship("Classification", back_populates="children", remote_side=[id])
    data_assets = relationship("DataAsset", back_populates="classification")
    
    def __repr__(self):
        return f"<Classification(code={self.code}, name={self.name})>"


class SensitiveTag(Base):
    """敏感标签模型"""
    __tablename__ = "sensitive_tags"
    
    id = Column(Integer, primary_key=True, index=True)
    code = Column(String(50), unique=True, index=True, nullable=False)
    name = Column(String(200), nullable=False)
    description = Column(Text)
    risk_level = Column(String(20), default="high")  # high/medium/low
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
    
    data_asset_tags = relationship("DataAssetTag", back_populates="tag")
    
    def __repr__(self):
        return f"<SensitiveTag(code={self.code}, name={self.name})>"


class DataAsset(Base):
    """数据资产模型"""
    __tablename__ = "data_assets"
    
    id = Column(Integer, primary_key=True, index=True)
    asset_name = Column(String(200), nullable=False, index=True)
    table_name = Column(String(200))
    description = Column(Text)
    source_system = Column(String(100))
    field_count = Column(Integer, default=0)
    record_count = Column(Integer, default=0)
    data_level = Column(String(50))  # 核心/重要/敏感/个人/内部/公开
    classification_id = Column(Integer, ForeignKey("classifications.id"))
    is_important_data = Column(Boolean, default=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
    
    classification = relationship("Classification", back_populates="data_assets")
    tags = relationship("DataAssetTag", back_populates="data_asset", cascade="all, delete-orphan")
    scenarios = relationship("DataAssetScenario", back_populates="data_asset", cascade="all, delete-orphan")
    
    def __repr__(self):
        return f"<DataAsset(name={self.asset_name}, level={self.data_level})>"
```

### 7. 跨境场景模型 (app/models/scenario.py)

```python
"""
跨境传输场景模型
作者：张彦龙
"""
from sqlalchemy import Column, Integer, String, DateTime, Text, Float, Boolean, ForeignKey, Table
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from app.core.database import Base
from typing import List


# 数据资产-场景关联表
data_asset_scenario = Table(
    "data_asset_scenario",
    Base.metadata,
    Column("data_asset_id", Integer, ForeignKey("data_assets.id"), primary_key=True),
    Column("scenario_id", Integer, ForeignKey("scenarios.id"), primary_key=True),
)


class Scenario(Base):
    """跨境传输场景模型"""
    __tablename__ = "scenarios"
    
    id = Column(Integer, primary_key=True, index=True)
    scenario_code = Column(String(50), unique=True, index=True, nullable=False)
    scenario_name = Column(String(200), nullable=False)
    scenario_type = Column(String(50))  # 审计/合规审查/报表汇总/业务处理
    status = Column(String(20), default="draft")  # draft/pending/approved/rejected/expired/paused
    
    # 接收方信息
    recipient_name = Column(String(200))
    recipient_country = Column(String(100))
    recipient_address = Column(Text)
    
    # 数据用途和期限
    data_purpose = Column(Text)
    storage_duration = Column(Integer)  # 存储天数
    
    # 传输信息
    transfer_frequency = Column(String(50))  # 一次性/日/周/月
    estimated_volume = Column(Integer)  # 预估数据量
    security_level = Column(String(20))  # 高/中/低
    encryption_method = Column(String(50))  # AES-256/AES-128
    
    # 审批信息
    approved_by = Column(Integer, ForeignKey("users.id"), nullable=True)
    approved_at = Column(DateTime(timezone=True), nullable=True)
    rejection_reason = Column(Text, nullable=True)
    
    # 有效期
    effective_date = Column(DateTime(timezone=True))
    expiry_date = Column(DateTime(timezone=True))
    
    created_by = Column(Integer, ForeignKey("users.id"))
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
    
    # 关联关系
    creator = relationship("User", foreign_keys=[created_by], back_populates="created_scenarios")
    approver = relationship("User", foreign_keys=[approved_by])
    data_assets = relationship("DataAsset", secondary=data_asset_scenario, back_populates="scenarios")
    risk_assessments = relationship("RiskAssessment", back_populates="scenario", cascade="all, delete-orphan")
    transfer_approvals = relationship("TransferApproval", back_populates="scenario", cascade="all, delete-orphan")
    
    def __repr__(self):
        return f"<Scenario(code={self.scenario_code}, name={self.scenario_name}, status={self.status})>"
```

### 8. 用户认证API (app/api/v1/endpoints/auth.py)

```python
"""
用户认证API
作者：张彦龙
"""
from fastapi import APIRouter, Depends, HTTPException, status
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.orm import Session
from datetime import timedelta
from app.core.database import get_db
from app.core.security import verify_password, create_access_token
from app.core.config import settings
from app.services.user_service import get_user_by_username
from app.schemas.user import Token, UserResponse

router = APIRouter()


@router.post("/token", response_model=Token)
async def login(form_data: OAuth2PasswordRequestForm = Depends(), db: Session = Depends(get_db)):
    """
    用户登录接口
    
    Args:
        form_data: OAuth2登录表单（用户名和密码）
        db: 数据库会话
    
    Returns:
        Token对象，包含访问令牌和令牌类型
    
    Raises:
        HTTPException: 401错误，用户名或密码错误
    """
    # 验证用户名和密码
    user = get_user_by_username(db, form_data.username)
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="用户名或密码错误",
            headers={"WWW-Authenticate": "Bearer"},
        )
    
    if not verify_password(form_data.password, user.password_hash):
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="用户名或密码错误",
            headers={"WWW-Authenticate": "Bearer"},
        )
    
    # 创建访问令牌
    access_token_expires = timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    access_token = create_access_token(
        data={"sub": user.username}, expires_delta=access_token_expires
    )
    
    return {
        "access_token": access_token,
        "token_type": "bearer",
        "user": {
            "id": user.id,
            "username": user.username,
            "email": user.email,
            "full_name": user.full_name,
            "is_active": user.is_active,
            "is_superuser": user.is_superuser
        }
    }


@router.get("/me", response_model=UserResponse)
async def get_current_user_info(current_user: User = Depends(get_current_active_user)):
    """
    获取当前用户信息
    
    Args:
        current_user: 当前登录用户
    
    Returns:
        用户信息
    """
    return current_user
```

### 9. 数据资产API (app/api/v1/endpoints/data_assets.py)

```python
"""
数据资产API
作者：张彦龙
"""
from fastapi import APIRouter, Depends, HTTPException, Query
from sqlalchemy.orm import Session
from typing import List, Optional
from app.core.database import get_db
from app.core.permissions import PermissionChecker, PermissionEnum
from app.models.user import User
from app.services.user_service import get_current_active_user
from app.services.data_asset_service import (
    get_data_assets,
    get_data_asset,
    create_data_asset,
    update_data_asset,
    delete_data_asset,
    scan_data_assets,
    get_classifications,
    get_sensitive_tags
)
from app.schemas.data_asset import (
    DataAsset,
    DataAssetCreate,
    DataAssetUpdate,
    DataAssetListResponse,
    ClassificationResponse,
    SensitiveTagResponse
)

router = APIRouter()


@router.get("", response_model=DataAssetListResponse)
async def list_data_assets(
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user),
    skip: int = Query(0, ge=0),
    limit: int = Query(20, ge=1, le=100),
    asset_name: Optional[str] = None,
    data_level: Optional[str] = None,
    source_system: Optional[str] = None
):
    """
    获取数据资产列表
    
    Args:
        db: 数据库会话
        current_user: 当前用户
        skip: 跳过的记录数
        limit: 返回的最大记录数
        asset_name: 资产名称筛选
        data_level: 数据级别筛选
        source_system: 来源系统筛选
    
    Returns:
        数据资产列表和总数
    """
    assets, total = get_data_assets(
        db, skip=skip, limit=limit,
        asset_name=asset_name,
        data_level=data_level,
        source_system=source_system
    )
    
    return {
        "items": assets,
        "total": total,
        "skip": skip,
        "limit": limit
    }


@router.get("/classifications", response_model=List[ClassificationResponse])
async def list_classifications(
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
):
    """
    获取数据分类列表
    
    Returns:
        分类列表
    """
    return get_classifications(db)


@router.get("/tags", response_model=List[SensitiveTagResponse])
async def list_sensitive_tags(
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
):
    """
    获取敏感标签列表
    
    Returns:
        敏感标签列表
    """
    return get_sensitive_tags(db)


@router.post("/scan")
async def scan_assets(
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
):
    """
    扫描数据库资产
    
    Returns:
        扫描结果
    """
    result = scan_data_assets(db)
    return {"message": "资产扫描完成", "count": result}


@router.post("", response_model=DataAsset)
async def create_asset(
    asset: DataAssetCreate,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
):
    """
    创建数据资产
    
    Args:
        asset: 数据资产信息
    
    Returns:
        创建的数据资产
    """
    return create_data_asset(db, asset)


@router.get("/{asset_id}", response_model=DataAsset)
async def get_asset(
    asset_id: int,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
):
    """
    获取单个数据资产详情
    
    Args:
        asset_id: 资产ID
    
    Returns:
        数据资产详情
    """
    db_asset = get_data_asset(db, asset_id)
    if not db_asset:
        raise HTTPException(status_code=404, detail="数据资产不存在")
    return db_asset


@router.put("/{asset_id}", response_model=DataAsset)
async def update_asset(
    asset_id: int,
    asset_update: DataAssetUpdate,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
):
    """
    更新数据资产
    
    Args:
        asset_id: 资产ID
        asset_update: 更新信息
    
    Returns:
        更新后的数据资产
    """
    db_asset = update_data_asset(db, asset_id, asset_update)
    if not db_asset:
        raise HTTPException(status_code=404, detail="数据资产不存在")
    return db_asset


@router.delete("/{asset_id}")
async def delete_asset(
    asset_id: int,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
):
    """
    删除数据资产
    
    Args:
        asset_id: 资产ID
    
    Returns:
        删除结果
    """
    success = delete_data_asset(db, asset_id)
    if not success:
        raise HTTPException(status_code=404, detail="数据资产不存在")
    return {"message": "删除成功"}
```

### 10. 数据资产服务 (app/services/data_asset_service.py)

```python
"""
数据资产业务逻辑服务
作者：张彦龙
"""
from sqlalchemy.orm import Session, joinedload
from typing import List, Optional, Tuple
from sqlalchemy import func
from app.models.data_asset import DataAsset, Classification, SensitiveTag, DataAssetTag
from app.schemas.data_asset import DataAssetCreate, DataAssetUpdate
from app.utils.data_scanner import scan_database_tables
from app.utils.classification_engine import classify_asset


def get_data_assets(
    db: Session,
    skip: int = 0,
    limit: int = 20,
    asset_name: Optional[str] = None,
    data_level: Optional[str] = None,
    source_system: Optional[str] = None
) -> Tuple[List[DataAsset], int]:
    """
    获取数据资产列表（支持筛选和分页）
    
    Args:
        db: 数据库会话
        skip: 跳过的记录数
        limit: 返回的最大记录数
        asset_name: 资产名称筛选
        data_level: 数据级别筛选
        source_system: 来源系统筛选
    
    Returns:
        (资产列表, 总数)
    """
    query = db.query(DataAsset).options(joinedload(DataAsset.classification))
    
    # 应用筛选条件
    if asset_name:
        query = query.filter(DataAsset.asset_name.contains(asset_name))
    if data_level:
        query = query.filter(DataAsset.data_level == data_level)
    if source_system:
        query = query.filter(DataAsset.source_system.contains(source_system))
    
    # 获取总数
    total = query.count()
    
    # 获取分页数据
    assets = query.order_by(DataAsset.asset_name).offset(skip).limit(limit).all()
    
    return assets, total


def get_data_asset(db: Session, asset_id: int) -> Optional[DataAsset]:
    """
    获取单个数据资产详情
    
    Args:
        db: 数据库会话
        asset_id: 资产ID
    
    Returns:
        数据资产对象或None
    """
    return db.query(DataAsset).filter(DataAsset.id == asset_id).first()


def create_data_asset(db: Session, asset: DataAssetCreate) -> DataAsset:
    """
    创建数据资产
    
    Args:
        db: 数据库会话
        asset: 数据资产信息
    
    Returns:
        创建的数据资产
    """
    # 自动分类
    classification_result = classify_asset(asset.dict())
    
    db_asset = DataAsset(
        asset_name=asset.asset_name,
        table_name=asset.table_name,
        description=asset.description,
        source_system=asset.source_system,
        field_count=asset.field_count,
        record_count=asset.record_count,
        data_level=classification_result.get("data_level", "internal"),
        classification_id=asset.classification_id,
        is_important_data=classification_result.get("is_important", False)
    )
    
    db.add(db_asset)
    db.commit()
    db.refresh(db_asset)
    
    # 添加敏感标签
    if asset.tag_ids:
        for tag_id in asset.tag_ids:
            tag = db.query(SensitiveTag).filter(SensitiveTag.id == tag_id).first()
            if tag:
                asset_tag = DataAssetTag(data_asset_id=db_asset.id, tag_id=tag_id)
                db.add(asset_tag)
        db.commit()
        db.refresh(db_asset)
    
    return db_asset


def update_data_asset(db: Session, asset_id: int, asset_update: DataAssetUpdate) -> Optional[DataAsset]:
    """
    更新数据资产
    
    Args:
        db: 数据库会话
        asset_id: 资产ID
        asset_update: 更新信息
    
    Returns:
        更新后的数据资产或None
    """
    db_asset = db.query(DataAsset).filter(DataAsset.id == asset_id).first()
    if not db_asset:
        return None
    
    update_data = asset_update.dict(exclude_unset=True)
    for field, value in update_data.items():
        setattr(db_asset, field, value)
    
    db.commit()
    db.refresh(db_asset)
    
    return db_asset


def delete_data_asset(db: Session, asset_id: int) -> bool:
    """
    删除数据资产
    
    Args:
        db: 数据库会话
        asset_id: 资产ID
    
    Returns:
        是否删除成功
    """
    db_asset = db.query(DataAsset).filter(DataAsset.id == asset_id).first()
    if not db_asset:
        return False
    
    db.delete(db_asset)
    db.commit()
    
    return True


def scan_data_assets(db: Session) -> int:
    """
    扫描数据库中的数据资产
    
    Args:
        db: 数据库会话
    
    Returns:
        扫描到的资产数量
    """
    # 扫描数据库表
    tables = scan_database_tables(db)
    
    count = 0
    for table_info in tables:
        # 检查是否已存在
        existing = db.query(DataAsset).filter(
            DataAsset.table_name == table_info["table_name"]
        ).first()
        
        if not existing:
            # 自动分类
            classification_result = classify_asset(table_info)
            
            # 创建新资产
            asset = DataAsset(
                asset_name=table_info["table_name"],
                table_name=table_info["table_name"],
                description=table_info.get("description", ""),
                source_system=table_info.get("source_system", "unknown"),
                field_count=table_info.get("field_count", 0),
                record_count=table_info.get("record_count", 0),
                data_level=classification_result.get("data_level", "internal"),
                is_important_data=classification_result.get("is_important", False)
            )
            
            db.add(asset)
            count += 1
    
    db.commit()
    
    return count


def get_classifications(db: Session) -> List[Classification]:
    """
    获取所有数据分类
    
    Args:
        db: 数据库会话
    
    Returns:
        分类列表
    """
    return db.query(Classification).order_by(Classification.code).all()


def get_sensitive_tags(db: Session) -> List[SensitiveTag]:
    """
    获取所有敏感标签
    
    Args:
        db: 数据库会话
    
    Returns:
        敏感标签列表
    """
    return db.query(SensitiveTag).order_by(SensitiveTag.code).all()
```

### 11. API路由配置 (app/api/v1/api.py)

```python
"""
API路由配置
作者：张彦龙
"""
from fastapi import APIRouter
from app.api.v1.endpoints import (
    auth,
    users,
    data_assets,
    scenarios,
    risk_assessments,
    approvals,
    audit,
    dashboard,
    export,
    batch,
    roles
)

api_router = APIRouter()

# 认证路由
api_router.include_router(auth.router, prefix="/auth", tags=["认证"])

# 用户路由
api_router.include_router(users.router, prefix="/users", tags=["用户"])

# 数据资产路由
api_router.include_router(data_assets.router, prefix="/data-assets", tags=["数据资产"])

# 跨境场景路由
api_router.include_router(scenarios.router, prefix="/scenarios", tags=["跨境场景"])

# 风险评估路由
api_router.include_router(risk_assessments.router, prefix="/risk-assessments", tags=["风险评估"])

# 传输审批路由
api_router.include_router(approvals.router, prefix="/approvals", tags=["传输审批"])

# 审计日志路由
api_router.include_router(audit.router, prefix="/audit", tags=["审计"])

# 监控仪表盘路由
api_router.include_router(dashboard.router, prefix="/dashboard", tags=["仪表盘"])

# 数据导出路由
api_router.include_router(export.router, prefix="/export", tags=["导出"])

# 批量操作路由
api_router.include_router(batch.router, prefix="/batch", tags=["批量操作"])

# 角色管理路由
api_router.include_router(roles.router, prefix="/roles", tags=["角色"])
```

### 12. 风险评估服务 (app/services/risk_service.py)

```python
"""
风险评估业务逻辑服务
作者：张彦龙
"""
from sqlalchemy.orm import Session
from typing import List, Dict, Optional, Tuple
from datetime import datetime
from sqlalchemy.orm import joinedload
from app.models.risk import RiskAssessment, AssessmentScore
from app.models.scenario import Scenario
from app.core.config import settings
from app.schemas.risk import RiskAssessmentCreate, RiskAssessmentUpdate


def create_risk_assessment(db: Session, assessment_data: RiskAssessmentCreate) -> RiskAssessment:
    """
    创建风险评估
    
    评估类型:
    - PIA: 个人信息保护影响评估
    - DPIA: 数据保护影响评估
    
    评分维度:
    - 法律环境 (0-100分)
    - 数据规模 (0-100分)
    - 安全措施 (0-100分)
    - 数据敏感性 (0-100分)
    
    风险等级:
    - 0-40分: 低风险
    - 40-60分: 中风险
    - 60-80分: 高风险
    - 80-100分: 极高风险
    """
    # 验证场景是否存在
    scenario = db.query(Scenario).filter(Scenario.id == assessment_data.scenario_id).first()
    if not scenario:
        raise ValueError("关联的场景不存在")
    
    # 创建评估
    assessment = RiskAssessment(
        assessment_code=assessment_data.assessment_code,
        assessment_name=assessment_data.assessment_name,
        assessment_type=assessment_data.assessment_type,
        scenario_id=assessment_data.scenario_id,
        status="draft",
        personal_info_count=assessment_data.personal_info_count,
        sensitive_info_count=assessment_data.sensitive_info_count,
        legal_environment_score=assessment_data.legal_environment_score,
        data_scale_score=assessment_data.data_scale_score,
        security_measures_score=assessment_data.security_measures_score,
        data_sensitivity_score=assessment_data.data_sensitivity_score
    )
    
    db.add(assessment)
    db.commit()
    db.refresh(assessment)
    
    return assessment


def calculate_risk_assessment(db: Session, assessment_id: int) -> RiskAssessment:
    """
    计算风险评估结果
    
    计算逻辑:
    1. 综合评分 = 各维度评分加权平均
    2. 根据评分确定风险等级
    3. 检查阈值
    4. 判断是否需要监管审批
    """
    assessment = db.query(RiskAssessment).filter(RiskAssessment.id == assessment_id).first()
    if not assessment:
        raise ValueError("评估不存在")
    
    # 计算综合评分（加权平均）
    weights = {
        "legal_environment": 0.3,
        "data_scale": 0.3,
        "security_measures": 0.2,
        "data_sensitivity": 0.2
    }
    
    overall_score = (
        assessment.legal_environment_score * weights["legal_environment"] +
        assessment.data_scale_score * weights["data_scale"] +
        assessment.security_measures_score * weights["security_measures"] +
        assessment.data_sensitivity_score * weights["data_sensitivity"]
    )
    
    # 确定风险等级
    if overall_score < 40:
        risk_level = "low"
    elif overall_score < 60:
        risk_level = "medium"
    elif overall_score < 80:
        risk_level = "high"
    else:
        risk_level = "critical"
    
    # 更新评估结果
    assessment.overall_score = round(overall_score, 2)
    assessment.risk_level = risk_level
    assessment.status = "completed"
    assessment.calculated_at = datetime.utcnow()
    
    # 保存详细评分
    scores = [
        AssessmentScore(
            assessment_id=assessment.id,
            dimension="法律环境",
            score=assessment.legal_environment_score,
            weight=weights["legal_environment"],
            description="目的国法律环境和监管要求评估"
        ),
        AssessmentScore(
            assessment_id=assessment.id,
            dimension="数据规模",
            score=assessment.data_scale_score,
            weight=weights["data_scale"],
            description="数据量和涉及个人信息数量的评估"
        ),
        AssessmentScore(
            assessment_id=assessment.id,
            dimension="安全措施",
            score=assessment.security_measures_score,
            weight=weights["security_measures"],
            description="技术保障措施和安全管理的评估"
        ),
        AssessmentScore(
            assessment_id=assessment.id,
            dimension="数据敏感性",
            score=assessment.data_sensitivity_score,
            weight=weights["data_sensitivity"],
            description="数据敏感程度和重要程度评估"
        )
    ]
    
    for score in scores:
        db.add(score)
    
    db.commit()
    db.refresh(assessment)
    
    return assessment


def threshold_check(db: Session, assessment_id: int) -> Dict:
    """
    阈值检查
    
    检查规则:
    1. 个人信息数量 > 100万: 需要监管审批
    2. 敏感个人信息数量 > 10万: 需要监管审批
    3. 超过阈值的95%: 预警提示
    """
    assessment = db.query(RiskAssessment).filter(RiskAssessment.id == assessment_id).first()
    if not assessment:
        raise ValueError("评估不存在")
    
    results = {
        "personal_info_threshold": settings.PERSONAL_INFO_THRESHOLD,
        "sensitive_info_threshold": settings.SENSITIVE_INFO_THRESHOLD,
        "checks": []
    }
    
    # 检查个人信息
    personal_info_check = {
        "type": "personal_info",
        "name": "个人信息数量",
        "actual": assessment.personal_info_count,
        "threshold": settings.PERSONAL_INFO_THRESHOLD,
        "percentage": round((assessment.personal_info_count / settings.PERSONAL_INFO_THRESHOLD) * 100, 2),
        "exceeded": assessment.personal_info_count > settings.PERSONAL_INFO_THRESHOLD,
        "near_threshold": assessment.personal_info_count > settings.PERSONAL_INFO_THRESHOLD * 0.95,
    }
    results["checks"].append(personal_info_check)
    
    # 检查敏感个人信息
    sensitive_info_check = {
        "type": "sensitive_info",
        "name": "敏感个人信息数量",
        "actual": assessment.sensitive_info_count,
        "threshold": settings.SENSITIVE_INFO_THRESHOLD,
        "percentage": round((assessment.sensitive_info_count / settings.SENSITIVE_INFO_THRESHOLD) * 100, 2),
        "exceeded": assessment.sensitive_info_count > settings.SENSITIVE_INFO_THRESHOLD,
        "near_threshold": assessment.sensitive_info_count > settings.SENSITIVE_INFO_THRESHOLD * 0.95,
    }
    results["checks"].append(sensitive_info_check)
    
    # 判断是否需要监管审批
    results["requires_regulatory_approval"] = any([
        personal_info_check["exceeded"],
        sensitive_info_check["exceeded"]
    ])
    
    return results


def get_risk_assessments(
    db: Session,
    skip: int = 0,
    limit: int = 20
) -> Tuple[List[RiskAssessment], int]:
    """
    获取风险评估列表
    
    Returns:
        (评估列表, 总数)
    """
    query = db.query(RiskAssessment).options(
        joinedload(RiskAssessment.scenario),
        joinedload(RiskAssessment.scores)
    )
    
    total = query.count()
    assessments = query.order_by(RiskAssessment.created_at.desc()).offset(skip).limit(limit).all()
    
    return assessments, total


def get_risk_assessment(db: Session, assessment_id: int) -> Optional[RiskAssessment]:
    """
    获取单个风险评估详情
    
    Returns:
        风险评估对象或None
    """
    return db.query(RiskAssessment).filter(RiskAssessment.id == assessment_id).first()
```

---

## 第二部分：前端核心代码

### 13. 前端主入口 (frontend/src/main.tsx)

```typescript
/**
 * 前端主入口文件
 * 作者：张彦龙
 */
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import App from './App';
import './index.css';

// 渲染应用
ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);
```

### 14. 前端主组件 (frontend/src/App.tsx)

```typescript
/**
 * 前端主组件
 * 作者：张彦龙
 */
import React, { useState, useEffect } from 'react';
import { Routes, Route, Navigate } from 'react-router-dom';
import { Layout, ConfigProvider } from 'antd';
import zhCN from 'antd/locale/zh_CN';
import Login from './pages/Login';
import Dashboard from './pages/Dashboard';
import DataAssets from './pages/DataAssets';
import Scenarios from './pages/Scenarios';
import RiskAssessments from './pages/RiskAssessments';
import Approvals from './pages/Approvals';
import AuditLogs from './pages/AuditLogs';
import Roles from './pages/Roles';
import Sidebar from './components/Sidebar';
import Header from './components/Header';
import { getToken } from './services/auth';
import './App.css';

const { Content } = Layout;

/**
 * 应用程序主组件
 * 管理全局状态和用户认证
 */
const App: React.FC = () => {
  const [isLoggedIn, setIsLoggedIn] = useState<boolean>(false);
  const [loading, setLoading] = useState<boolean>(true);

  useEffect(() => {
    // 检查用户是否已登录
    const token = getToken();
    setIsLoggedIn(!!token);
    setLoading(false);
  }, []);

  const handleLogin = () => {
    setIsLoggedIn(true);
  };

  const handleLogout = () => {
    localStorage.removeItem('token');
    setIsLoggedIn(false);
  };

  if (loading) {
    return <div>加载中...</div>;
  }

  return (
    <ConfigProvider locale={zhCN}>
      <div className="app">
        {!isLoggedIn ? (
          <Routes>
            <Route path="/login" element={<Login onLogin={handleLogin} />} />
            <Route path="*" element={<Navigate to="/login" />} />
          </Routes>
        ) : (
          <Layout style={{ minHeight: '100vh' }}>
            <Sidebar />
            <Layout>
              <Header onLogout={handleLogout} />
              <Content style={{ margin: '24px', padding: '24px', background: '#fff' }}>
                <Routes>
                  <Route path="/" element={<Dashboard />} />
                  <Route path="/data-assets" element={<DataAssets />} />
                  <Route path="/scenarios" element={<Scenarios />} />
                  <Route path="/risk-assessments" element={<RiskAssessments />} />
                  <Route path="/approvals" element={<Approvals />} />
                  <Route path="/audit-logs" element={<AuditLogs />} />
                  <Route path="/roles" element={<Roles />} />
                  <Route path="*" element={<Navigate to="/" />} />
                </Routes>
              </Content>
            </Layout>
          </Layout>
        )}
      </div>
    </ConfigProvider>
  );
};

export default App;
```

### 15. 认证服务 (frontend/src/services/auth.ts)

```typescript
/**
 * 认证服务
 * 作者：张彦龙
 */
import { message } from 'antd';
import axios from 'axios';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';

export interface LoginRequest {
  username: string;
  password: string;
}

export interface LoginResponse {
  access_token: string;
  token_type: string;
  user: {
    id: number;
    username: string;
    email: string;
    full_name: string;
    is_active: boolean;
    is_superuser: boolean;
  };
}

/**
 * 用户登录
 * @param data 登录表单数据
 * @returns 登录响应数据
 */
export const login = async (data: LoginRequest): Promise<LoginResponse> => {
  const formData = new FormData();
  formData.append('username', data.username);
  formData.append('password', data.password);

  const response = await axios.post(`${API_URL}/api/v1/auth/token`, formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });

  if (response.status === 200) {
    const loginData = response.data;
    localStorage.setItem('token', loginData.access_token);
    localStorage.setItem('user', JSON.stringify(loginData.user));
    return loginData;
  }

  throw new Error('登录失败');
};

/**
 * 获取token
 * @returns token字符串
 */
export const getToken = (): string | null => {
  return localStorage.getItem('token');
};

/**
 * 获取当前用户
 * @returns 当前用户信息
 */
export const getCurrentUser = (): any => {
  const userStr = localStorage.getItem('user');
  return userStr ? JSON.parse(userStr) : null;
};

/**
 * 清除认证信息
 */
export const clearAuth = (): void => {
  localStorage.removeItem('token');
  localStorage.removeItem('user');
};

/**
 * 检查是否已登录
 * @returns 是否已登录
 */
export const isAuthenticated = (): boolean => {
  return !!getToken();
};

// 设置axios拦截器
axios.interceptors.request.use(
  (config) => {
    const token = getToken();
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 401错误处理
axios.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      clearAuth();
      message.error('登录已过期，请重新登录');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

### 16. 数据资产管理页面 (frontend/src/pages/DataAssets.tsx)

```typescript
/**
 * 数据资产管理页面
 * 作者：张彦龙
 */
import React, { useState, useEffect } from 'react';
import { Table, Button, Tag, Space, Input, Select, message, Modal, Descriptions } from 'antd';
import { SearchOutlined, PlusOutlined, ReloadOutlined, EyeOutlined } from '@ant-design/icons';
import { getDataAssets, scanDataAssets, getClassifications, getSensitiveTags } from '../services/dataAssetService';
import type { DataAsset, Classification, SensitiveTag } from '../types/dataAsset';

const { Search } = Input;
const { Option } = Select;

const DataAssets: React.FC = () => {
  const [data, setData] = useState<DataAsset[]>([]);
  const [loading, setLoading] = useState<boolean>(false);
  const [total, setTotal] = useState<number>(0);
  const [selectedAsset, setSelectedAsset] = useState<DataAsset | null>(null);
  const [detailModalVisible, setDetailModalVisible] = useState<boolean>(false);
  const [classifications, setClassifications] = useState<Classification[]>([]);
  const [tags, setTags] = useState<SensitiveTag[]>([]);
  
  const [filters, setFilters] = useState({
    asset_name: '',
    data_level: '',
    source_system: '',
    skip: 0,
    limit: 20,
  });

  useEffect(() => {
    fetchData();
    fetchMetaData();
  }, [filters]);

  const fetchData = async () => {
    setLoading(true);
    try {
      const response = await getDataAssets(filters);
      setData(response.items);
      setTotal(response.total);
    } catch (error) {
      message.error('获取数据资产失败');
    } finally {
      setLoading(false);
    }
  };

  const fetchMetaData = async () => {
    try {
      const [classificationsRes, tagsRes] = await Promise.all([
        getClassifications(),
        getSensitiveTags(),
      ]);
      setClassifications(classificationsRes);
      setTags(tagsRes);
    } catch (error) {
      console.error('获取元数据失败', error);
    }
  };

  const handleScan = async () => {
    setLoading(true);
    try {
      const result = await scanDataAssets();
      message.success(`扫描完成，新增 ${result.count} 个数据资产`);
      fetchData();
    } catch (error) {
      message.error('扫描数据资产失败');
    } finally {
      setLoading(false);
    }
  };

  const handleSearch = (value: string) => {
    setFilters({ ...filters, asset_name: value, skip: 0 });
  };

  const handleLevelChange = (value: string) => {
    setFilters({ ...filters, data_level: value, skip: 0 });
  };

  const handleTableChange = (pagination: any) => {
    setFilters({
      ...filters,
      skip: (pagination.current - 1) * pagination.pageSize,
      limit: pagination.pageSize,
    });
  };

  const showDetail = (record: DataAsset) => {
    setSelectedAsset(record);
    setDetailModalVisible(true);
  };

  const getLevelColor = (level: string) => {
    const colorMap: Record<string, string> = {
      '核心': 'red',
      '重要': 'orange',
      '敏感个人信息': 'volcano',
      '个人信息': 'blue',
      '内部': 'cyan',
      '公开': 'green',
    };
    return colorMap[level] || 'default';
  };

  const columns = [
    {
      title: '资产名称',
      dataIndex: 'asset_name',
      key: 'asset_name',
      width: 200,
    },
    {
      title: '来源系统',
      dataIndex: 'source_system',
      key: 'source_system',
      width: 150,
    },
    {
      title: '数据级别',
      dataIndex: 'data_level',
      key: 'data_level',
      width: 130,
      render: (level: string) => (
        <Tag color={getLevelColor(level)}>{level}</Tag>
      ),
    },
    {
      title: '字段数',
      dataIndex: 'field_count',
      key: 'field_count',
      width: 100,
    },
    {
      title: '记录数',
      dataIndex: 'record_count',
      key: 'record_count',
      width: 120,
      render: (count: number) => count?.toLocaleString(),
    },
    {
      title: '重要数据',
      dataIndex: 'is_important_data',
      key: 'is_important_data',
      width: 100,
      render: (isImportant: boolean) => (
        isImportant ? <Tag color="red">是</Tag> : <Tag>否</Tag>
      ),
    },
    {
      title: '创建时间',
      dataIndex: 'created_at',
      key: 'created_at',
      width: 180,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: DataAsset) => (
        <Space>
          <Button
            type="link"
            size="small"
            icon={<EyeOutlined />}
            onClick={() => showDetail(record)}
          >
            详情
          </Button>
        </Space>
      ),
    },
  ];

  return (
    <div className="data-assets-page">
      <div className="page-header">
        <h1>数据资产管理</h1>
        <Space>
          <Button
            type="primary"
            icon={<ReloadOutlined />}
            onClick={handleScan}
            loading={loading}
          >
            扫描资产
          </Button>
        </Space>
      </div>

      <div className="search-filters">
        <Space wrap>
          <Search
            placeholder="搜索资产名称"
            onSearch={handleSearch}
            style={{ width: 250 }}
            allowClear
          />
          <Select
            placeholder="数据级别"
            style={{ width: 150 }}
            onChange={handleLevelChange}
            allowClear
          >
            <Option value="">全部</Option>
            <Option value="核心">核心</Option>
            <Option value="重要">重要</Option>
            <Option value="敏感个人信息">敏感个人信息</Option>
            <Option value="个人信息">个人信息</Option>
            <Option value="内部">内部</Option>
            <Option value="公开">公开</Option>
          </Select>
        </Space>
      </div>

      <Table
        columns={columns}
        dataSource={data}
        rowKey="id"
        loading={loading}
        pagination={{
          total,
          current: Math.floor(filters.skip / filters.limit) + 1,
          pageSize: filters.limit,
          showSizeChanger: true,
          showQuickJumper: true,
        }}
        onChange={handleTableChange}
        scroll={{ x: 1200 }}
      />

      <Modal
        title="数据资产详情"
        visible={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedAsset && (
          <Descriptions column={2} bordered>
            <Descriptions.Item label="资产名称" span={2}>
              {selectedAsset.asset_name}
            </Descriptions.Item>
            <Descriptions.Item label="表名称">
              {selectedAsset.table_name}
            </Descriptions.Item>
            <Descriptions.Item label="数据级别">
              <Tag color={getLevelColor(selectedAsset.data_level)}>
                {selectedAsset.data_level}
              </Tag>
            </Descriptions.Item>
            <Descriptions.Item label="来源系统">
              {selectedAsset.source_system}
            </Descriptions.Item>
            <Descriptions.Item label="字段数">
              {selectedAsset.field_count}
            </Descriptions.Item>
            <Descriptions.Item label="记录数">
              {selectedAsset.record_count?.toLocaleString()}
            </Descriptions.Item>
            <Descriptions.Item label="重要数据">
              {selectedAsset.is_important_data ? '是' : '否'}
            </Descriptions.Item>
            <Descriptions.Item label="分类">
              {selectedAsset.classification?.name}
            </Descriptions.Item>
            <Descriptions.Item label="敏感标签" span={2}>
              <Space>
                {selectedAsset.tags?.map((tag) => (
                  <Tag key={tag.id} color="red">
                    {tag.tag_name}
                  </Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="描述" span={2}>
              {selectedAsset.description}
            </Descriptions.Item>
            <Descriptions.Item label="创建时间">
              {selectedAsset.created_at}
            </Descriptions.Item>
            <Descriptions.Item label="更新时间">
              {selectedAsset.updated_at}
            </Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default DataAssets;
```

### 17. API服务封装 (frontend/src/services/api.ts)

```typescript
/**
 * Axios API服务封装
 * 作者：张彦龙
 */
import axios, { AxiosRequestConfig, AxiosResponse, AxiosError } from 'axios';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';

// 创建axios实例
const api = axios.create({
  baseURL: API_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// 请求拦截器
api.interceptors.request.use(
  (config) => {
    // 添加认证token
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 响应拦截器
api.interceptors.response.use(
  (response) => {
    return response;
  },
  (error: AxiosError) => {
    // 统一错误处理
    if (error.response) {
      const { status, data } = error.response;
      
      switch (status) {
        case 401:
          // 未授权，清除token并跳转登录
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.href = '/login';
          break;
        case 403:
          // 权限不足
          console.error('权限不足:', data);
          break;
        case 404:
          // 资源未找到
          console.error('资源未找到:', data);
          break;
        case 500:
          // 服务器错误
          console.error('服务器错误:', data);
          break;
        default:
          console.error('请求错误:', data);
      }
    } else if (error.request) {
      console.error('网络错误或请求超时:', error.message);
    } else {
      console.error('请求配置错误:', error.message);
    }
    
    return Promise.reject(error);
  }
);

/**
 * GET请求
 */
export const get = async <T = any>(
  url: string,
  config?: AxiosRequestConfig
): Promise<T> => {
  const response: AxiosResponse<T> = await api.get(url, config);
  return response.data;
};

/**
 * POST请求
 */
export const post = async <T = any>(
  url: string,
  data?: any,
  config?: AxiosRequestConfig
): Promise<T> => {
  const response: AxiosResponse<T> = await api.post(url, data, config);
  return response.data;
};

/**
 * PUT请求
 */
export const put = async <T = any>(
  url: string,
  data?: any,
  config?: AxiosRequestConfig
): Promise<T> => {
  const response: AxiosResponse<T> = await api.put(url, data, config);
  return response.data;
};

/**
 * DELETE请求
 */
export const del = async <T = any>(
  url: string,
  config?: AxiosRequestConfig
): Promise<T> => {
  const response: AxiosResponse<T> = await api.delete(url, config);
  return response.data;
};

/**
 * 批量请求
 */
export const all = async <T = any>(
  requests: Promise<T>[]
): Promise<T[]> => {
  return Promise.all(requests);
};

export default api;
```

---

## 代码特点说明

### 1. 技术架构
- **后端**: FastAPI + Python 3.11 + SQLAlchemy
- **前端**: React 18 + TypeScript + Ant Design
- **数据库**: PostgreSQL 14

### 2. 代码组织
- 采用MVC设计模式
- 模块化开发，职责清晰
- 类型安全（TypeScript + Pydantic）

### 3. 安全特性
- JWT Token认证
- 密码bcrypt加密
- 角色权限控制
- CORS跨域防护

### 4. 功能完整
- 9大核心功能模块
- 完整的CRUD操作
- 风险评估算法
- 动态脱敏引擎
- **批量操作功能**（批量审批、批量删除）
- **数据导出功能**（CSV/JSON格式导出）

### 5. 代码质量
- 类型注释完整
- 错误处理完善
- 日志记录详细
- API文档自动生成
- 批量操作结果反馈机制
- 大文件导出优化

---

**文档说明**: 以上代码为软件著作权申请用源代码文档，包含了系统核心功能前后各30页代码（每页约50行），总代码量约15,000行。

**开发者**: 张彦龙
**版本**: v1.2.0
**完成日期**: 2024年12月
