# 银行重要数据跨境管控系统
## 软件使用说明书

### 一、软件概述

#### 1.1 软件名称
银行重要数据跨境管控系统 v1.2.0

#### 1.2 开发背景
随着《数据安全法》、《个人信息保护法》和《数据出境安全评估办法》的颁布实施，银行机构在跨境数据传输方面面临着严格的合规要求。为满足银行对重要数据和敏感个人信息跨境传输的管理需求，开发本系统以实现数据出境全流程的自动化管控。

#### 1.3 软件用途
本系统是为银行机构设计的一套跨境数据传输合规管控平台，实现数据资产识别、跨境场景管理、风险评估、传输审批、事中拦截、动态脱敏和监控审计等全流程功能，确保银行数据出境活动符合国家法律法规要求。

#### 1.4 运行环境

**服务端环境:**
- 操作系统: Linux/Windows/macOS
- Python版本: 3.11+
- 数据库: PostgreSQL 14+
- 内存要求: 4GB以上
- 硬盘空间: 50GB以上

**客户端环境:**
- 操作系统: Windows 7/10/11, macOS, Linux
- 浏览器: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 网络环境: 支持HTTP/HTTPS协议的网络环境

### 二、软件功能

#### 2.1 系统架构
本系统采用前后端分离架构：
- **前端**: React 18 + TypeScript + Ant Design
- **后端**: FastAPI + Python 3.11
- **数据库**: PostgreSQL 14+
- **认证机制**: JWT Token

#### 2.2 核心功能模块

##### 2.2.1 用户认证与权限管理
- 用户登录认证（JWT Token）
- 角色管理（CRUD操作）
- 权限分配与验证
- 用户会话管理

**操作说明:**
1. 打开系统首页: `http://localhost:3000`
2. 输入用户名和密码
3. 点击"登录"按钮进入系统

##### 2.2.2 数据资产分类分级管理
- 自动扫描数据库资产
- 敏感数据识别和标记
- 数据安全级别划分（核心/重要/敏感/个人/内部/公开）
- 敏感标签定义和管理
- 数据血缘追踪

**操作步骤:**
1. 点击左侧导航"数据资产"菜单
2. 查看数据资产列表
3. 点击"扫描资产"按钮扫描新的数据资产
4. 点击资产名称查看详情
5. 支持CSV/JSON格式导出

##### 2.2.3 跨境传输场景管理
- 跨境业务场景备案
- 传输要素管理（接收方、目的国、存储期限、传输频率等）
- 场景状态管理（草稿/待审批/已批准/已拒绝/已过期/已暂停）
- 场景审批流程
- 有效期管理

**操作步骤:**
1. 点击"跨境场景"菜单
2. 点击"新建场景"按钮
3. 填写场景信息（业务类型、接收方、目的国等）
4. 提交审批
5. 管理员批准或拒绝场景
6. 支持批量批准/拒绝操作

##### 2.2.4 数据出境风险自评估
- PIA/DPIA评估模板
- 多维度风险评估（法律环境、数据规模、安全措施、数据敏感性）
- 阈值预警检查（100万个人信息/10万敏感个人信息）
- 风险等级计算（低/中/高/极高）
- 监管审批需求判断

**操作步骤:**
1. 点击"风险评估"菜单
2. 点击"新建评估"按钮
3. 选择评估类型（PIA/DPIA）
4. 填写评估信息和评分
5. 点击"执行评估"按钮
6. 查看评估结果和风险等级
7. 查看阈值检查报告

##### 2.2.5 传输审批管理
- 传输申请创建
- 审批流程管理（批准/拒绝）
- 审批状态跟踪
- 传输记录管理
- 批量审批操作

**操作步骤:**
1. 点击"传输审批"菜单
2. 点击"新建申请"按钮
3. 选择关联场景和传输数据资产
4. 提交审批申请
5. 管理员审批（批准/拒绝）
6. 查看传输记录和状态

##### 2.2.6 事中拦截与动态脱敏
- 白名单策略管理
- 黑名单策略管理
- 核心数据自动拦截
- 动态脱敏引擎
  - 身份证脱敏（保留前3后4位）
  - 手机号脱敏（保留前3后4位）
  - 银行卡脱敏（保留后4位）
  - 姓名假名化（SHA256哈希）
  - 邮箱脱敏

**功能说明:**
系统自动对未授权的数据传输进行拦截，对已授权传输的数据根据规则自动进行脱敏处理，确保敏感信息在跨境传输过程中的安全性。

##### 2.2.7 监控与审计仪表盘
- 概览统计（场景数、审批数、传输成功率、异常数）
- 传输趋势分析（按日期统计）
- 目的国分布统计
- 风险预警展示
- 审计日志记录
- 异常行为检测

**操作步骤:**
1. 点击"监控仪表盘"查看系统概览
2. 查看实时统计信息
3. 查看传输趋势图表
4. 查看目的国分布
5. 查看风险预警信息
6. 点击"审计日志"查看详细操作记录

##### 2.2.8 数据导出功能
- CSV格式导出
- JSON格式导出
- 支持数据资产、场景、审计日志等模块导出
- 批量导出操作

**操作步骤:**
1. 在各模块列表页面点击"导出"按钮
2. 选择导出格式（CSV/JSON）
3. 系统生成并下载文件

### 三、安装与部署

#### 3.1 环境准备

**安装Python 3.11+:**
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3.11 python3-pip

# CentOS/RHEL
sudo yum install python3.11

# macOS
brew install python@3.11
```

**安装Node.js 18+:**
```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install nodejs

# macOS
brew install node@18
```

**安装PostgreSQL 14+:**
```bash
# Ubuntu/Debian
sudo apt install postgresql-14

# macOS
brew install postgresql@14
```

#### 3.2 后端部署

**步骤1: 克隆代码**
```bash
git clone [仓库地址]
cd backend
```

**步骤2: 安装依赖**
```bash
pip install -r requirements.txt
```

**步骤3: 配置数据库**
```bash
# 创建数据库
python create_db.py

# 初始化表结构
python init_db.py

# 初始化用户
python init_users.py
```

**步骤4: 启动服务**
```bash
uvicorn app.main:app --reload --port 8000
```

**步骤5: 访问API文档**
打开浏览器访问: `http://localhost:8000/api/docs`

#### 3.3 前端部署

**步骤1: 进入前端目录**
```bash
cd frontend
```

**步骤2: 安装依赖**
```bash
npm install
```

**步骤3: 启动开发服务器**
```bash
npm run dev
```

**步骤4: 访问前端界面**
打开浏览器访问: `http://localhost:3000`

#### 3.4 一键启动（推荐）

**步骤1: 添加执行权限**
```bash
chmod +x start.sh
```

**步骤2: 运行启动脚本**
```bash
./start.sh
```

脚本将自动完成：
- 检查数据库连接
- 启动后端服务（端口8000）
- 启动前端服务（端口3000）
- 显示访问地址和默认登录信息

### 四、使用示例

#### 4.1 完整业务流程示例

**场景：某银行需要将客户信息传输至境外母行进行年度审计**

**步骤1: 扫描数据资产**
1. 点击"数据资产"菜单
2. 点击"扫描资产"按钮
3. 系统自动识别并标记敏感数据
4. 查看数据安全级别（DWS_CUST_ALL被识别为"敏感个人信息"）

**步骤2: 创建跨境场景**
1. 点击"跨境场景"菜单
2. 点击"新建场景"
3. 填写场景信息：
   - 场景名称: 母行集团年度审计
   - 业务类型: 审计
   - 接收方: 母行总部
   - 目的国: 美国
   - 数据用途: 年度财务审计
   - 存储期限: 365天
   - 传输频率: 一次性
   - 安全级别: 高
   - 加密方式: AES-256
4. 点击"提交审批"

**步骤3: 执行风险评估**
1. 点击"风险评估"菜单
2. 点击"新建评估"
3. 选择评估类型: PIA
4. 关联场景: 母行集团年度审计
5. 填写评估信息：
   - 法律环境评分: 75
   - 数据规模评分: 60
   - 安全措施评分: 85
   - 数据敏感性评分: 70
6. 点击"执行评估"
7. 查看评估结果：
   - 综合评分: 72.5分
   - 风险等级: 中风险
   - 阈值检查结果：敏感个人信息超过10万条阈值
   - 建议：需要监管审批和数据脱敏

**步骤4: 场景审批**
1. 管理员登录系统
2. 点击"跨境场景"菜单
3. 找到"母行集团年度审计"场景
4. 点击"批准"按钮
5. 填写审批意见
6. 场景状态更新为"已批准"

**步骤5: 创建传输审批**
1. 点击"传输审批"菜单
2. 点击"新建申请"
3. 选择关联场景: 母行集团年度审计
4. 选择数据资产: DWS_CUST_ALL, DWS_FINA_GL
5. 填写传输信息:
   - 传输类型: API
   - 预计传输量: 500,000条
6. 提交审批申请

**步骤6: 传输审批**
1. 管理员查看传输申请
2. 根据风险评估结果，要求进行数据脱敏
3. 批准传输请求
4. 系统自动对敏感数据进行脱敏处理
5. 开始数据传输

**步骤7: 监控审计**
1. 点击"监控仪表盘"查看实时传输状态
2. 查看传输成功率
3. 查看审计日志记录
4. 监控异常行为

#### 4.2 动态脱敏效果示例

**原始数据:**
```json
{
  "customer_name": "张三",
  "id_card": "110101199003072345",
  "mobile": "13812345678",
  "bank_card": "6222020123456789012"
}
```

**脱敏后数据:**
```json
{
  "customer_name": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
  "id_card": "110***********2345",
  "mobile": "138****5678",
  "bank_card": "************9012"
}
```

#### 4.3 阈值预警示例

**场景**: 某传输场景涉及500,000条个人信息，其中120,000条为敏感个人信息

**系统预警:**
- 个人信息: 500,000条（未超过100万阈值）✅
- 敏感个人信息: 120,000条（超过10万阈值）⚠️
- 预警信息: "敏感个人信息量已达到阈值的120%，需要监管审批"
- 风险等级: 高风险
- 处理建议: 建议进行数据脱敏处理，并签署数据出境标准合同

### 五、系统配置

#### 5.1 配置文件

配置文件位置: `backend/app/core/config.py`

**主要配置项:**
```python
# 项目信息
PROJECT_NAME = "银行重要数据跨境数据管控系统"
VERSION = "1.2.0"

# 数据库配置
POSTGRES_SERVER = "localhost"
POSTGRES_USER = "postgres"
POSTGRES_PASSWORD = "your-password"
POSTGRES_DB = "datareg"

# JWT配置
SECRET_KEY = "your-secret-key"
ACCESS_TOKEN_EXPIRE_MINUTES = 1440  # 24小时

# 合规阈值配置
PERSONAL_INFO_THRESHOLD = 1000000      # 100万个人信息
SENSITIVE_INFO_THRESHOLD = 100000      # 10万敏感个人信息

# Redis配置（可选）
REDIS_HOST = "localhost"
REDIS_PORT = 6379
```

#### 5.2 环境变量配置

创建 `.env` 文件：
```bash
cp .env.example .env
```

编辑 `.env` 文件配置：
```env
# 数据库
POSTGRES_SERVER=localhost
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-password
POSTGRES_DB=datareg

# JWT
SECRET_KEY=your-secret-key

# CORS
CORS_ORIGINS=["http://localhost:3000"]
```

### 六、常见问题和故障排除

#### 6.1 无法登录系统

**问题现象:** 输入正确的用户名和密码后无法登录

**解决方法:**
1. 检查后端服务是否启动: `http://localhost:8000/api/docs`
2. 检查数据库连接是否正常
3. 检查浏览器Console是否有JavaScript错误
4. 检查网络连接是否正常
5. 确认用户名和密码正确（默认: admin / admin123）

#### 6.2 数据库连接失败

**问题现象:** 提示"无法连接数据库"或"Database connection failed"

**解决方法:**
1. 确保PostgreSQL服务已启动
2. 检查数据库配置信息是否正确
3. 检查防火墙设置
4. 验证数据库用户权限
5. 查看数据库日志排查问题

#### 6.3 前端无法连接后端

**问题现象:** 前端页面加载正常，但数据无法加载，提示API调用失败

**解决方法:**
1. 确保后端服务已启动
2. 检查CORS配置是否正确
3. 检查前端API地址配置
4. 检查代理配置（开发环境）
5. 查看浏览器Network面板排查问题

#### 6.4 数据扫描失败

**问题现象:** 点击"扫描资产"按钮后没有反应或提示错误

**解决方法:**
1. 检查数据库连接权限
2. 确认数据库中有可读表
3. 查看后端日志排查具体错误
4. 检查数据库用户是否有SELECT权限

### 七、技术支持和联系方式

**开发者:** 张彦龙

**文档版本:** 1.2.0

**最后更新:** 2024年12月

### 八、版本历史

| 版本 | 发布日期 | 更新内容 |
|------|----------|----------|
| v1.0.0 | 2024-12 | 初始版本，包含核心功能模块 |
| v1.1.0 | 2024-12 | 完善前端界面，用户认证系统 |
| v1.2.0 | 2024-12 | 增加角色权限管理、数据导出、批量操作 |

---

**版权声明:** 本软件受著作权法保护，未经授权不得复制、分发或用于商业用途。
